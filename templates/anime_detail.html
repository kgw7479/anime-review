<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{{ anime.title }} - Anime Review</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header class="site-header">
        <div class="site-header-inner">
            <div>
                <h1 class="logo">Anime Review</h1>
                <p class="logo-subtitle">애니 한 편, 리뷰 한 줄씩 쌓아가기</p>
            </div>
            <nav class="site-nav">
                <a href="/anime" class="nav-link">애니 목록</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <section class="detail-header">
            <img src="{{ url_for('static', filename=anime.image_url) }}"
                 alt="{{ anime.title }}"
                 class="detail-poster">

            <div class="detail-info">
                <h2 class="detail-title">{{ anime.title }}</h2>
                <p class="detail-genre">
                    장르: <span class="badge-genre">{{ anime.genre }}</span>
                </p>

                {% if anime.avg_rating %}
                    <p class="detail-rating">
                        평균 별점:
                        <span class="rating-strong">
                            ★ {{ "%.1f"|format(anime.avg_rating) }} / 10
                        </span>
                    </p>
                {% else %}
                    <p class="detail-rating">
                        평균 별점: <span class="rating-empty">아직 없습니다.</span>
                    </p>
                {% endif %}

                <a href="/anime" class="back-link">← 애니 목록으로 돌아가기</a>
            </div>
        </section>

        <hr class="section-divider">

        <section class="review-section">
            <h3>리뷰 남기기</h3>
            <form action="/anime/{{ anime_id }}/review" method="post" class="review-form">
                <div class="form-row">
                    <label for="rating">별점</label>
                    <select id="rating" name="rating">
                        {% for i in range(1, 11) %}
                            <option value="{{ i }}">{{ i }}</option>
                        {% endfor %}
                    </select>
                    <span class="rating-max">/ 10</span>
                </div>

                <div class="form-row">
                    <label for="content">리뷰</label>
                    <textarea id="content"
                              name="content"
                              rows="4"
                              placeholder="에피소드, 캐릭터, 연출, 느낀 점 등 자유롭게 적어보세요."></textarea>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-primary">리뷰 등록</button>
                </div>
            </form>
        </section>

        <section class="review-section">
            <h3>리뷰 목록</h3>

        <div class="review-sort">
    <a href="?sort=newest" class="sort-btn {% if sort=='newest' %}active{% endif %}">최신순</a>
    <a href="?sort=rating_desc" class="sort-btn {% if sort=='rating_desc' %}active{% endif %}">별점 높은 순</a>
    <a href="?sort=rating_asc" class="sort-btn {% if sort=='rating_asc' %}active{% endif %}">별점 낮은 순</a>
</div>

            {% if reviews %}
                <ul class="review-list">
                    {% for r in reviews %}
                        <li class="review-item">
                            <div class="review-header">
                                <span class="review-rating">★ {{ r.rating }} / 10</span>
                            </div>
                            <p class="review-content">{{ r.content }}</p>
                            <form action="/anime/{{ anime_id }}/review/{{ r.id }}/delete"
                                  method="post"
                                  class="review-delete-form">
                                <button type="submit" class="btn-secondary">삭제</button>
                            </form>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="review-empty">아직 등록된 리뷰가 없습니다. 첫 리뷰를 남겨보세요!</p>
            {% endif %}
        </section>
    </main>
</body>
</html>
